FROM node:14-alpine

ENV NODE_ENV=development
ARG DATABASE_URL
ARG JWT_SECRET
ARG FORTYTWO_APP_ID
ARG FORTYTWO_APP_SECRET
ARG FORTYTWO_CALLBACK_URL
ARG FRONTEND_URL

ENV DATABASE_URL ${DATABASE_URL}
ENV JWT_SECRET ${JWT_SECRET}
ENV FORTYTWO_APP_ID ${FORTYTWO_APP_ID}
ENV FORTYTWO_APP_SECRET ${FORTYTWO_APP_SECRET}
ENV FORTYTWO_CALLBACK_URL ${FORTYTWO_CALLBACK_URL}
ENV FRONTEND_URL ${FRONTEND_URL}

WORKDIR /app

ENV PATH /app/node_modules/.bin:$PATH

COPY package.json ./
COPY package-lock.json ./
RUN npm install

COPY . ./
COPY ./prisma ./prisma

RUN npx prisma generate

EXPOSE 3000

CMD ["npm", "run", "start:dev-prisma"]